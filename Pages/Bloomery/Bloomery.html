<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NZ7L2LT2');</script>
    <!-- End Google Tag Manager -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#12151e">
  <title>TFC Ratios - Bloomery</title>
  <meta name="description" content="Interactive calculator for TerraFirmaCraft Bloomery optimization">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link href="./Bloomery.css" rel="stylesheet">
  <link href="../Styles/base.css" rel="stylesheet">
  <link href="../Styles/navbar.css" rel="stylesheet">
  <link href="../Styles/items.css" rel="stylesheet">


  <script src="https://www.desmos.com/api/v1.8/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
  <script src="../routing.js"></script>
  <script src="Bloomery.js"></script>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NZ7L2LT2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <!-- ==================== NAVIGATION ==================== -->
  <nav id="nav" class="nav">
    <button class="nav-back" onclick="showView('menu')">
      <svg viewBox="0 0 16 16" fill="none"><path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Back to Menu
    </button>
    <div class="nav-divider"></div>
    <button id="nav-bloomery" class="nav-link">Bloomery</button>
    <button id="nav-alloys" class="nav-link" onclick="showView('Alloys')">Alloys</button>
  </nav>


  <!-- Bloomery -->
  <section id="view-bloomery" class="page">
    <div class="bloomery-full">
      <header class="page-header">
        <h1>Bloomery Calculator</h1>
        <p>Define iron ore coefficients and calculate optimal combinations for maximum efficiency.</p>
      </header>

      <!-- Iron Configuration Card -->
      <div class="card">
        <div class="iron-header">
          <div style="display:flex;align-items:center;gap:10px;">
            <div class="mineral-dot" style="background:#E76F51;"></div>
            <h3>Iron Ore</h3>
          </div>
        </div>

        <div class="coeff-list" id="iron-coeff-list"></div>

        <div class="coeff-actions">
          <button class="btn-xs" onclick="bloomeryAddCoeff()">+ Add Coefficient</button>
          <div style="width:1px;height:16px;background:var(--border)"></div>
          <button class="btn-xs" onclick="bloomeryApplyPreset('A')">144/36/16</button>
          <button class="btn-xs" onclick="bloomeryApplyPreset('B')">129/31/13</button>
        </div>
      </div>

      <!-- Calculate Bar -->
      <div class="calc-bar">
        <button id="bloomery-calc-btn" class="btn-calc" onclick="bloomeryCalculate()">
          <svg viewBox="0 0 20 20" fill="none"><path d="M10 2L18 18H2L10 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/><circle cx="10" cy="12" r="2" fill="currentColor"/></svg>
          Calculate
        </button>
      </div>

      <!-- Results Section -->
      <div id="bloomery-results-wrap" class="results-wrap hidden">

        <!-- Layout: Results on left, Graph on right -->
        <div class="results-layout">

          <!-- Left Column: Results -->
          <div class="results-column">

            <!-- Best Result Card -->
            <div class="best-result-card">
              <div class="best-badge">
                <svg viewBox="0 0 16 16" fill="none"><path d="M8 1L10.163 5.38279L15 6.11803L11.5 9.52918L12.326 14.382L8 12.1L3.674 14.382L4.5 9.52918L1 6.11803L5.837 5.38279L8 1Z" fill="currentColor"/></svg>
                Best Result
              </div>
              <div class="best-content" id="best-result-content">
                <div class="best-stats">
                  <div class="best-stat">
                    <span class="best-stat-label">Ingots</span>
                    <span class="best-stat-value" id="best-ingots">0</span>
                  </div>
                  <div class="best-stat">
                    <span class="best-stat-label">Iron Ore</span>
                    <span class="best-stat-value" id="best-ore">0</span>
                  </div>
                  <div class="best-stat">
                    <span class="best-stat-label">Total MB</span>
                    <span class="best-stat-value" id="best-mb">0</span>
                  </div>
                </div>
                <div class="best-detail" id="best-detail"></div>
              </div>
            </div>

            <!-- Top 3 Results -->
            <div class="top3-section">
              <h3 class="section-title">Top 3 Results</h3>
              <div class="top3-grid" id="top3-grid"></div>
            </div>

            <!-- All Results Table (Expandable) -->
            <div class="expandable-section">
              <button class="expandable-toggle" id="bloomery-table-toggle" onclick="toggleBloomeryTable()">
                <span>All Calculated Points</span>
                <div class="expandable-toggle-right">
                  <span id="bloomery-points-count">0 points</span>
                  <svg viewBox="0 0 16 16" fill="none"><path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </div>
              </button>
              <div class="expandable-body" id="bloomery-table-body">
                <table class="data-table" id="bloomery-data-table"></table>
              </div>
            </div>

          </div>

          <!-- Right Column: Graph -->
          <div class="graph-column">
            <div class="graph-container">
              <h3 class="graph-title">Efficiency Graph</h3>
              <div id="bloomery-calculator" class="graph-canvas"></div>
            </div>
          </div>

        </div>

      </div>

    </div>
  </section>

</body>
</html>
